# ============================================
# МОДЕЛИ И API
# ============================================
models:
  whisper:
    provider: "local"
    model_size: "large-v3"
    device: "cuda"
    gpu_id: 0
    compute_type: "float16"
    language: "en"
    temperature: 0.0

  translation:
    provider: "openrouter"
    model: "mistralai/ministral-14b-2512"
    api_key_env: "OPENROUTER_API_KEY"
    temperature: 0.3
    max_tokens: 512
    streaming: true

  tts:
    provider: "cosyvoice"  # "xtts" or "cosyvoice"

    # CosyVoice3 settings (provider: "cosyvoice")
    model_dir: "models/CosyVoice3-0.5B"
    system_prompt: "You are a helpful assistant.<|endofprompt|>Говорите естественно и выразительно."

    # XTTS-v2 settings (provider: "xtts") - LEGACY
    model: "tts_models/multilingual/multi-dataset/xtts_v2"

    # Common settings
    device: "cuda"
    gpu_id: 1
    voice_sample: "voice_samples/Aleksandr.wav"
    language: "ru"
    streaming: true
    output_sample_rate: 24000
    speed: 1.3  # Speech speed multiplier (1.0 = normal, 1.3 = 30% faster)

# ============================================
# PIPELINE ПАРАМЕТРЫ
# ============================================
pipeline:
  context_window: 10
  context_max_chars: 2000
  batch_queue_size: 8  # Pipeline processing: 8 slots for non-stop playback (increased for literal mode)
  max_batch_duration: 15.0
  min_ready_chunks_before_start: 1  # TRUE STREAMING: Играть каждый чанк сразу как готов (no buffering)
  
  vad:
    enabled: true
    threshold: 0.5
    min_speech_duration: 3.0    # Minimum 3 sec of speech before processing (bigger chunks)
    min_silence_duration: 1.0   # 1.0 sec silence = end of phrase (balance: not too short, not too long)
    min_chunk_duration: 12.0    # MINIMUM 12 sec input audio (ensures 7+ sec TTS output to cover processing time 7-9s)
    max_phrase_duration: 18.0   # MAXIMUM 18 sec input audio (ensures ~12 sec TTS output, FAT chunks to cover processing)
    speech_pad_ms: 200
  
  audio:
    sample_rate: 16000
    chunk_duration_ms: 100
    buffer_duration_sec: 30
  
  timeouts:
    whisper_api: 30.0
    translation_api: 10.0
    tts_synthesis: 15.0
  
  retry:
    max_attempts: 3
    backoff_factor: 1.5

# ============================================
# WEB SERVER
# ============================================
server:
  host: "0.0.0.0"
  port: 8000
  cors_origins:
    - "*"
  websocket_max_size: 10485760

# ============================================
# МОНИТОРИНГ И ЛОГИ
# ============================================
monitoring:
  enabled: true
  log_level: "INFO"
  log_dir: "./logs"
  
  metrics:
    collect_interval: 5.0
    vram_alert_threshold: 14000
    latency_alert_threshold: 10.0
  
  session:
    save_transcripts: true
    save_translations: true
    save_audio: false

# ============================================
# FEATURE FLAGS
# ============================================
features:
  smart_chunking: true
  hallucination_filter: true
  translation_cache: false
  adaptive_batching: true
